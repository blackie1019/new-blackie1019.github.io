<!-- build time:Mon Sep 30 2019 16:23:16 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE HTML><html lang="zh-TW"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="keywords" content="ASP.NET Core MVC play with Google Container Engine, blackie tsai, blackie1019"><meta name="description" content="使用Google Container Engine 是Google所推出的Container Host Cluster服務，讓Docker(Cotainer)透過Cluster環境來執行你所寫的ASP.NET Core MVC程式。Goog"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>ASP.NET Core MVC play with Google Container Engine | Blackie&#39;s Failed Notes</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.1/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><style type="text/css"></style><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script><link rel="stylesheet" href="/new-blackie1019.github.io/css/prism-tomorrow.css" type="text/css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper head-container"><div class="brand-logo"><a href="/new-blackie1019.github.io/" class="waves-effect waves-light"><img src="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">Blackie's Failed Notes</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>Tags</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>Categories</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>Archives</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>About</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>Recommend</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/atom.xml" class="waves-effect waves-light"><i class="fas fa-rss" style="zoom:.6"></i> <span>RSS</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="Search" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">Blackie's Failed Notes</div><div class="logo-desc">Interested in JavaScript, ASP.NET Core, Cloud and Solution Architecture.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> Tags</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> Categories</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> Archives</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> About</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> Recommend</a></li><li class="m-nav-item"><a href="/atom.xml" class="waves-effect waves-light"><i class="fa-fw fas fa-rss"></i> RSS</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/6.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><div class="description center-align post-title">ASP.NET Core MVC play with Google Container Engine</div></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.8.0/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px}#toc-content .is-active-link{color:#42b983}#toc-content .is-active-link::before{background-color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/new-blackie1019.github.io/tags/ASP-NET-Core/"><span class="chip bg-color">ASP.NET Core</span> </a><a href="/new-blackie1019.github.io/tags/NET-Core/"><span class="chip bg-color">.NET Core</span> </a><a href="/new-blackie1019.github.io/tags/Docker/"><span class="chip bg-color">Docker</span> </a><a href="/new-blackie1019.github.io/tags/Container/"><span class="chip bg-color">Container</span> </a><a href="/new-blackie1019.github.io/tags/GCP/"><span class="chip bg-color">GCP</span> </a><a href="/new-blackie1019.github.io/tags/GKE/"><span class="chip bg-color">GKE</span> </a><a href="/new-blackie1019.github.io/tags/Google-Container-Engine/"><span class="chip bg-color">Google Container Engine</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/new-blackie1019.github.io/categories/Cloud/" class="post-category">Cloud</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp; 2017-04-15</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp; 2.6k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp; 10 Min</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><p>使用Google Container Engine 是Google所推出的Container Host Cluster服務，讓Docker(Cotainer)透過Cluster環境來執行你所寫的ASP.NET Core MVC程式。</p><p><a href="https://cloud.google.com/free/?hl=zh-tw" target="_blank" rel="noopener">Google Cloud免費試用</a>可以讓我們一個月有免費獲得 $300 美元的試用額度，並且這包含平台中的所有服務．甚至到免費試用期結束後不會自動延續服務收費．</p><p>而Google Container Engine (GKE) 是Google所推出的Container Host Cluster服務，GKE 一方面允許擴展可以使用的資源，另一方面則可以讓執行時候可以有容錯的可能性(避免單點錯誤的狀況發生)。而為什麼叫GKE而不是叫GCE勒，原因在於K指的是Google 自家的kubernetes系統。Docker本身強調build, ship and run的觀念，透過K8S作完整的管理即可達到擴展性與可修復等特性。</p><p>這次分享如何將ASP.NET Core運行在GKE上，對於Google Cloud Platform的基本介紹可以參考先前的<a href="https://blackie1019.github.io/2017/04/11/Google-Cloud-Platform-Introduction/">Google Cloud Platform Introduction</a></p><p>運行起來的網站連結=&gt;<a href="http://35.185.170.247:8080/" target="_blank" rel="noopener">demo網站</a></p><h1 id="Google-App-Type-GAE-GKE-and-GCE"><a href="#Google-App-Type-GAE-GKE-and-GCE" class="headerlink" title="Google App Type : GAE, GKE, and GCE"></a>Google App Type : GAE, GKE, and GCE</h1><p><img src="Iaas_Paas.png" alt="Iaas_Paas"></p><p>針對不同的彈性與管理/開發上的用途，Google Cloud Platform上可以Hosting的服務有以下三種:</p><h2 id="Google-Compute-Engine-GCE"><a href="#Google-Compute-Engine-GCE" class="headerlink" title="Google Compute Engine(GCE)"></a>Google Compute Engine(GCE)</h2><p>等同於用VM的觀念來使用Google Cloud</p><h2 id="Google-App-Engine-GAE"><a href="#Google-App-Engine-GAE" class="headerlink" title="Google App Engine(GAE)"></a>Google App Engine(GAE)</h2><p>Google App Engine(GAE) 讓使用者可以在Google的基礎架構之上執行網路應用程式，分為Standard與Flexible兩種不同的Runtime。對於能使用的開發的語言有所限制，但相對GCE來講，可以更簡單且快速的將你的程式做部屬，且也針對network, security,monitoring與performace tuning做了設定與調整。</p><h2 id="Google-Container-Engine-GKE"><a href="#Google-Container-Engine-GKE" class="headerlink" title="Google Container Engine(GKE)"></a>Google Container Engine(GKE)</h2><p>讓你可以使用Docker與k8s做更彈性的動態拓展，實現containerlize</p><h2 id="Deploying-Comparison"><a href="#Deploying-Comparison" class="headerlink" title="Deploying Comparison"></a>Deploying Comparison</h2><p><img src="deploying_comparison.png" alt="deploying_comparison"></p><h1 id="Kubernetes-Introduction"><a href="#Kubernetes-Introduction" class="headerlink" title="Kubernetes Introduction"></a>Kubernetes Introduction</h1><p>Kubernetes (K8S) 是 Google 團隊發起並維護的Docker開源Container Host Cluster管理系統，它支援常見的雲平台(Google Cloud, AWS, Azure)，也支援內部架設。而這個專案本身是起源至<a href="https://research.google.com/pubs/pub43438.html" target="_blank" rel="noopener">Borg</a>．有興趣要了解這個K8S的可以參考<a href="https://kubernetes.io/" target="_blank" rel="noopener">K8S.io</a>．</p><p>Google 於2015年釋出K8S後，引起了話題。原先僅是屬於內部專案 – Borg，之後IT大廠如Redhat, CoreOS, IBM, 甚至 Amazon, Microsoft 這些公有雲端供應商都搶著整合進自己的服務中。</p><p>![kubernetes pods](kubernetes pods.png)</p><p>K8S本身透過GO來實作，有以下的特性:</p><ul><li>簡單：輕量級，簡單，容易理解</li><li>方便：支援公有雲，私有雲，混合處理雲，以及多種雲平台</li><li>拓展姓：模組化，可插拔，支援鉤子，可任意組合</li><li>自修復：自動重調度，自動重啟，自動複製</li></ul><p>針對K8S更詳細的介紹請參考<a href="https://wild0522.gitbooks.io/yeasy_dp/content/kubernetes/" target="_blank" rel="noopener">yeasy docker practice 2017年正體中文譯本 - Kubernetes</a>)</p><p><img src="kubernetes_design.jpg" alt="kubernetes_design"></p><p>以下節錄重點介紹</p><ul><li>節點（Node）：一個節點是一個執行 Kubernetes 中的主電腦。</li><li>容器組（Pod）：一個 Pod 對應於由若干容器組成的一個容器組，同個組內的容器共享一個儲存卷(volume)。</li><li>容器組生命週期（pos-states）：包含所有容器狀態集合，包括容器組狀態類型，容器組生命週期，事件，重啟原則，以及replication controllers。</li><li>Replication Controllers（replication-controllers）：主要負責指定數量的pod在同一時間一起執行。</li><li>服務（services）：一個Kubernetes服務是容器組邏輯的進階抽像，同時也對外提供存取容器組的原則。</li><li>卷（volumes）：一個卷就是一個目錄，容器對其有存取許可。</li><li>標籤（labels）：標籤是用來連線一組對象的，比如容器組。標籤可以被用來組織和選擇子物件。</li><li>介面權限（accessing_the_api）：連接埠，ip位址和代理的防火牆規則。</li><li>web 界面（ux）：使用者可以透過 web 界面作業Kubernetes。</li><li>指令行指令列作業（cli）：kubecfg指令。</li></ul><h2 id="Kubernetes-Overviw"><a href="#Kubernetes-Overviw" class="headerlink" title="Kubernetes Overviw"></a>Kubernetes Overviw</h2><p>K8S屬於分散式架構，主要由三個元件所構成：</p><ol><li>Master – 主節點，負責主要管理與協調各Node</li><li>Node – 主要工作的節點，上面運行了許多容器(Pod)。之前看過，在1.3版的K8S可操控高達2,000個nodes以上，可支援60,000個Pod。這邊最有名的案例就是Niantic推出的Pokémon Go</li><li>Masters和Nodes組成叢集(Clusters)</li></ol><p>kubernetes pods:</p><p>![kubernetes pods](kubernetes pods.png)</p><p>kubernetes pods 細節:</p><p>![kubernetes pods_detail](kubernetes pods_detail.png)</p><p>對於上述說明看不太懂的朋友，誠摯的推薦花8分鐘看下面的影片！</p><p><a href="http://www.bilibili.com/blackboard/player.html?aid=10087636&cid=16669885&page=1" target="_blank" rel="noopener">写给孩子看的 Kubernetes 动画指南【中英字幕】</a></p><h1 id="ASP-NET-Core-MVC-Play-with-GKE"><a href="#ASP-NET-Core-MVC-Play-with-GKE" class="headerlink" title="ASP.NET Core MVC Play with GKE"></a>ASP.NET Core MVC Play with GKE</h1><h2 id="Create-ASP-NET-Core-MVC-Project"><a href="#Create-ASP-NET-Core-MVC-Project" class="headerlink" title="Create ASP.NET Core MVC Project"></a>Create ASP.NET Core MVC Project</h2><p>首先我們先建立專案資料夾</p><pre><code>mkdir AspNetDockerDemo</code></pre><p>接著我們就透過dotnet CLI工具幫我們建立mvc專案</p><pre><code>dotnet new mvc</code></pre><p>專案建立後我們就透過nuget幫我們還原專案有關的類別庫並執行它</p><pre><code>dotnet restore
dotnet run</code></pre><p>這邊我們執行該專案如果可以看到以下畫面就代表網站建立成功了</p><p><img src="mvcsite.png" alt="mvcsite"></p><h2 id="Publish-Release-Version-Application"><a href="#Publish-Release-Version-Application" class="headerlink" title="Publish Release Version Application"></a>Publish Release Version Application</h2><p>實務上在正式環境運行時我們會將ASP.NET Core編譯成release的版本才做發佈，所以這邊我們先編譯release並發佈該版本</p><pre><code>dotnet publish -c Release</code></pre><p>當成功建立後我們先確認一下現在建立的專案目錄：</p><p><img src="project.png" alt="project"></p><p>這邊可以看到我們的程式已經編譯且放在bin&gt;Release&gt;netcoreapp1.1&gt;publish中</p><p>我們可以透過以下方式將網站再次運行確認打包出來的東西是否正確</p><pre><code>cd bin\Release\netcoreapp1.1\publish
dotnet AspNetDocker.dll</code></pre><h2 id="Containerize-Application-into-Docker-Container"><a href="#Containerize-Application-into-Docker-Container" class="headerlink" title="Containerize Application into Docker Container"></a>Containerize Application into Docker Container</h2><p>當我們程式都確定撰寫完畢且編譯成Release發佈後，我們就可以到該發佈的資料夾內建立Dockerfile(注意檔名為大寫且沒有副檔名)</p><pre><code>touch Dockerfile</code></pre><p>Dockerfile內容如下:</p><pre><code>FROM microsoft/dotnet:1.1.1-runtime
COPY . /app
WORKDIR /app
EXPOSE 8080/tcp
ENV  ASPNETCORE_URLS http://*:8080
ENTRYPOINT [&quot;dotnet&quot;,&quot;AspNetDockerDemo.dll&quot;]</code></pre><p>這邊我們特別指定使用ASP.NET Core 1.1.1-runtime的版本而非SDK版，兩者的差異可以看<a href="https://hub.docker.com/r/microsoft/dotnet/" target="_blank" rel="noopener">Docker Hub上的說明</a>．</p><p>接著我們在資料夾路徑內建立該docker image：</p><pre><code>docker build -t blackie1019/aspnetcoredemo:gke .</code></pre><p>建立完成後我們將該映像檔實際運行起來看看是否正常:</p><pre><code>docker run -d -p 8080:8080 -t blackie1019/aspnetcoredemo:gke</code></pre><p>執行成功後確認一下是否正常運行(-a是為了列出正在執行跟沒有執行的所有container)：</p><pre><code>docker image -a</code></pre><p><img src="docker_running_container.png" alt="docker_running_container"></p><p>如果都沒問題我們就可以到<a href="localhost:8080" target="_blank" rel="noopener">localhost:8080</a>實際看到我們的網站．接下來我們將開始設定google cloud platform</p><h2 id="Register-and-Create-Google-Cloud-Project"><a href="#Register-and-Create-Google-Cloud-Project" class="headerlink" title="Register and Create Google Cloud Project"></a>Register and Create Google Cloud Project</h2><p>首先到<a href="https://cloud.google.com/" target="_blank" rel="noopener">Google Cloud Platform</a>進行帳號註冊</p><p>Google Cloud Platform不同於AWS與Azure在網頁介面上是把每個服務分類後在單一服務裡面呈現所有與該服務有關的專案，它採用專案導向的方式建立服務，所以我們需要建立一個專案(project)才可以針對該專案建立相關服務．</p><p>至<a href="https://console.cloud.google.com/home/dashboard" target="_blank" rel="noopener">Dashboard</a>我們先建立一個新的專案，建立完後我們可以看到該專案的project-id</p><p><img src="gcp_dashboard.png" alt="gcp_dashboard"></p><p><img src="gcp_project_id.png" alt="gcp_project_id"></p><h2 id="Download-and-Setup-Google-Cloud-SDK"><a href="#Download-and-Setup-Google-Cloud-SDK" class="headerlink" title="Download and Setup Google Cloud SDK"></a>Download and Setup Google Cloud SDK</h2><p><a href="https://cloud.google.com/sdk/" target="_blank" rel="noopener">Google Cloud SDK</a>是一個官方推出的Command-line工具</p><p>小編這邊用的電腦是macOS的系統，須先將python更新至2.7版以上，然後依序執行下面指令</p><pre><code>curl https://sdk.cloud.google.com | bash</code></pre><p>重啟shell或是透過下面指令直接重啟</p><pre><code>exec -l $SHELL</code></pre><p>接著我們初始化sdk，這個步驟會將登入資料跟設定記憶在該電腦環境中</p><pre><code>gcloud init</code></pre><h2 id="Publish-ASP-NET-Core-MVC-App-to-Cloud"><a href="#Publish-ASP-NET-Core-MVC-App-to-Cloud" class="headerlink" title="Publish ASP.NET Core MVC App to Cloud"></a>Publish ASP.NET Core MVC App to Cloud</h2><h3 id="Create-a-Kubernetes-Cluster"><a href="#Create-a-Kubernetes-Cluster" class="headerlink" title="Create a Kubernetes Cluster"></a>Create a Kubernetes Cluster</h3><p>在安裝Google Cloud SDK後我們需要安裝kubectl這個元件(components)：</p><pre><code>docker components install kubectl</code></pre><p>之後可以透過該工具來幫我們建立Kubernetes Cluster:</p><pre><code>gcloud container clusters create gcd-demo-cluster --zone asia-east1-a</code></pre><p>[–zone參數](<a href="https://cl$" target="_blank" rel="noopener">https://cl$</a> gcloud container clusters get-credentials hello-dotnet-cluster \ –zone europe-west1-b –project<project_id>oud.google.com/sdk/gcloud/reference/compute/zones/list)是讓我們指定要建立的region位置，實際上能用的region我們可以透過下面指令查詢：</project_id></p><pre><code>gcloud compute zones list</code></pre><p><img src="gcloud_compute_zoon.png" alt="gcloud_compute_zoon"></p><p>如果不想透過指令建立也可以透過GUI介面建置：</p><p><img src="gcp_container_engine.png" alt="gcp_container_engine"></p><h3 id="Config-kubectl-command-line-Access-to-the-Kubernetes-Cluster"><a href="#Config-kubectl-command-line-Access-to-the-Kubernetes-Cluster" class="headerlink" title="Config kubectl command line Access to the Kubernetes Cluster"></a>Config kubectl command line Access to the Kubernetes Cluster</h3><p>在使用前我們需要先透過<a href="https://cloud.google.com/sdk/gcloud/reference/container/clusters/get-credentials" target="_blank" rel="noopener">get-credentials</a>設定要使用的Kubernetes Cluster</p><pre><code>gcloud container clusters get-credentials gcd-demo-cluster --zone &quot;asia-east1-a&quot; -project gcddemo-164215</code></pre><p><img src="gcloud_contain_cluster_after.png" alt="gcloud_contain_cluster_after"></p><p>這邊如果我們沒有按照上一步建立Kubernetes Cluster或是打錯名稱就會出現下面找不到的錯誤：</p><p><img src="gcloud_contain_cluster_before.png" alt="gcloud_contain_cluster_before"></p><h3 id="Push-Image-to-Goole-Container-Registry"><a href="#Push-Image-to-Goole-Container-Registry" class="headerlink" title="Push Image to Goole Container Registry"></a>Push Image to Goole Container Registry</h3><p>接著我們將先前建立好的docker 映像檔上傳至<a href="https://cloud.google.com/container-registry/" target="_blank" rel="noopener">Goole Container Registry</a>，但在運行前我們先將剛剛的映像檔加入新的tag方便gcloud指令可以找到它：</p><pre><code>docker tag blackie1019/aspnetcoredemo:gke gcr.io/gcddemo-164215</code></pre><p><img src="docker_tag_after.png" alt="docker_tag_after"></p><p>然後我們用docker – push的方式上傳至Goole Container Registry</p><pre><code>gcloud docker -- push gcr.io/gcddemo-164215</code></pre><p><img src="gcloud_docker_upload.png" alt="gcloud_docker_upload"></p><h3 id="Deploy-App-to-Google-Container-Engine"><a href="#Deploy-App-to-Google-Container-Engine" class="headerlink" title="Deploy App to Google Container Engine"></a>Deploy App to Google Container Engine</h3><p>當我們將上面docer映像檔上傳完成後，就可以透過下面指令將它實際運行起來：</p><pre><code>kubectl run net-core-mvc-demo --image=grc.io/gcddemo-164215 \ --port=8080 deployment &quot;net-core-mvc-demo&quot; created</code></pre><p><img src="kubectl_run.png" alt="kubectl_run"></p><p>我們可以用get deployments與get pods查看剛剛建立的情況</p><p><img src="kubectl_get_deployments.png" alt="kubectl_get_deployments"></p><p>這邊pods的建立需要時間所以當我們確認他狀態為running後才表示真的可以用</p><p><img src="kubectl_get_pods.png" alt="kubectl_get_pods"></p><p>當pods正常運行後我們還須多做一個設定將我們的8080 port開發對外</p><pre><code>kubectl expose deployment net-core-mvc-demo --port=8080 --type=&quot;LoadBalancer&quot; service &quot;net-core-mvc-demo&quot; exposed</code></pre><p>該指令執行後由於建立service需要一點時間所以我們可以透過下面指令查看目前狀態(從pending=&gt;給ip)：</p><p><img src="kubectl_service.png" alt="kubectl_service"></p><p>當我們看到它被指派了external-ip後我們就可以到這個ip與搭配的port好去看該網站了，<a href="http://35.185.170.247:8080/" target="_blank" rel="noopener">http://35.185.170.247:8080/</a></p><p>整個弄完後Recap一下整個架構會如下圖：</p><p><img src="gke-concepts.png" alt="gke-concepts"></p><h1 id="補充-Google-App-Engine-Environment"><a href="#補充-Google-App-Engine-Environment" class="headerlink" title="[補充] Google App Engine Environment"></a>[補充] Google App Engine Environment</h1><p>Google App Engine 有兩個環境(Environment)類型:</p><h2 id="App-Engine-Standard-Environment"><a href="#App-Engine-Standard-Environment" class="headerlink" title="App Engine Standard Environment"></a>App Engine Standard Environment</h2><ul><li><p>Managed runtimes for specific versions of Java, Python, PHP &amp; Go</p></li><li><p>Autoscale workloads to meet demand</p></li><li><p>Free daily quota, usage based pricing</p></li><li><p>SDKs for development, testing and deployment</p></li><li><p>Need to conform to sandbox constraints:</p><ul><li>No writing to local file system</li><li>Request timeouts at 60 seconds</li><li>Limit on 3rd-party software installations</li></ul></li></ul><p>以下是官方以Web應用程式給的運作流程範例：</p><p><img src="app_engine_standard_work_flow.png" alt="app_engine_standard_work_flow"></p><h2 id="App-Engine-Flexible-Environment-Beta"><a href="#App-Engine-Flexible-Environment-Beta" class="headerlink" title="App Engine Flexible Environment (Beta)"></a>App Engine Flexible Environment (Beta)</h2><ul><li>Build, deploy containerized apps with a click</li><li>Standard runtimes - Python, Java, Go, Node.js - with no sandbox constraints</li><li>Custom runtime support for any language that supports HTTP requests</li><li>During beta pricing based on Compute Engine usage</li><li>Local development relies on Docker</li><li>Standard runtimes can access App Engine services: Datastore, Memcache, task queues, logging, users, and so on</li></ul><p>Flexible Environment 因為可使用Custom runtime，我們就可以自行定義Container的dockerfile，而這樣的檔案也可以沿用到GKE的架構．</p><h2 id="Standard-and-Flexible-Environment-Comparison"><a href="#Standard-and-Flexible-Environment-Comparison" class="headerlink" title="Standard and Flexible Environment Comparison"></a>Standard and Flexible Environment Comparison</h2><p><img src="app_engine_comparison.png" alt="app_engine_comparison"></p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li><a href="https://www.slideshare.net/peihsinsu/google-cloud-computing-compares-gce-gae-and-gke" target="_blank" rel="noopener">Google Cloud Computing compares GCE, GAE and GKE</a></li><li><a href="https://www.cool3c.com/article/119184" target="_blank" rel="noopener">GKE 系列文章(一) – 為什麼使用 Kubernetes</a></li><li><a href="http://www.ithome.com.tw/voice/108907" target="_blank" rel="noopener">Pokémon GO全球大賣的隱形關鍵</a></li><li><a href="https://codelabs.developers.google.com/codelabs/cloud-app-engine-aspnetcore/#0" target="_blank" rel="noopener">Deploy an ASP.NET Core App to App Engine</a></li><li><a href="https://github.com/gcpug-tw/gcp-demo" target="_blank" rel="noopener">GCPUG.TW-GCP Demos</a></li><li><a href="https://www.gitbook.com/book/peihsinsu/docker-note-book/details" target="_blank" rel="noopener">Docker學習筆記</a></li><li><a href="https://www.gitbook.com/book/gcpug-tw/kuberbetes-in-action/details" target="_blank" rel="noopener">Kubernetes學習筆記</a></li><li><a href="https://cloudplatform.googleblog.com/2016/10/managing-containerized-ASP.NET-Core-apps-with-Kubernetes.html" target="_blank" rel="noopener">Managing containerized ASP.NET Core apps with Kubernetes</a></li><li><a href="https://cloud.google.com/container-registry/docs/pushing" target="_blank" rel="noopener">Google Cloud Platform - Pushing to Container Registry</a></li><li><a href="http://tonybai.com/2016/11/16/how-to-pull-images-from-private-registry-on-kubernetes-cluster/" target="_blank" rel="noopener">Kubernetes从Private Registry中拉取容器镜像的方法</a></li><li><a href="https://kubernetes.io/docs/tutorials/stateless-application/expose-external-ip-address-service/" target="_blank" rel="noopener">Using a Service to Access an Application in a Cluster</a></li><li><a href="https://gcpug-tw.gitbooks.io/google-cloud-platform-in-practice/content/container-engine/gke-basics.html" target="_blank" rel="noopener">GCPUG.TW : GKE基本操作</a></li></ul></div><hr><div class="signature"><img class="signature-profile" alt="profile2" src="/medias/signature.jpg"><div class="mwt_border"><span class="arrow_l_int"></span> <span class="arrow_l_out"></span><p>如果覺得還不錯麻煩請在文章上面給予推薦，支持是持續努力產出的動力</p></div></div><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,linkedin,facebook" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.88rem}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22AB38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019FE8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的賞識是我前進的動力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script><div class="reprint" id="reprint-statement"><p class="reprint-tip"><i class="fas fa-exclamation-triangle"></i>&nbsp;&nbsp; <span>Reprint policy</span></p><div class="center-align"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/" target="_blank"><img alt="" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></div><br><a href="/new-blackie1019.github.io/2017/04/15/ASP-NET-Core-MVC-play-with-Goolge-Container-Engine/">《ASP.NET Core MVC play with Google Container Engine》 </a>by <a href="https://blackie1019.github.io/new-blackie1019.github.io">Blackie </a>is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script></div></div><div class="disqus-card card" data-aos="fade-up"><div id="disqus_thread" class="card-content"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div><script type="text/javascript">disqus_config = function () {
        this.page.url = 'https://blackie1019.github.io/new-blackie1019.github.io/2017/04/15/ASP-NET-Core-MVC-play-with-Goolge-Container-Engine/';
        this.page.identifier = '/2017/04/15/ASP-NET-Core-MVC-play-with-Goolge-Container-Engine/';
        this.page.title = 'ASP.NET Core MVC play with Google Container Engine';
    };
    let disqus_shortname = 'blackie1019';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;Previous</div><div class="card"><a href="/new-blackie1019.github.io/2017/04/16/ASP-NET-Core-play-with-Solution-File/"><div class="card-image"><img src="/medias/featureimages/1.jpg" class="responsive-img" alt="ASP.NET Core play with Solution File"> <span class="card-title">ASP.NET Core play with Solution File</span></div></a><div class="card-content article-content"><div class="summary block-with-text">介紹如何建立solution檔案幫我們連接多個project同於在ASP.NET的開發，ASP.NET Core也可以使用.sln檔案幫我們建立與多個csharproj檔案的關聯性如果我們今天的整個開發會將底層的應用函式庫與執行的網頁應用程</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2017-04-16 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/new-blackie1019.github.io/categories/NET/" class="post-category">.NET</a></span></div></div><div class="card-action article-tags"><a href="/new-blackie1019.github.io/tags/ASP-NET-Core/"><span class="chip bg-color">ASP.NET Core</span> </a><a href="/new-blackie1019.github.io/tags/NET-Core/"><span class="chip bg-color">.NET Core</span> </a><a href="/new-blackie1019.github.io/tags/C/"><span class="chip bg-color">C#</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">Next&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/new-blackie1019.github.io/2017/04/14/Dotnet-CLI-Create-New-Project-With-Target-Framework-Version/"><div class="card-image"><img src="/medias/featureimages/9.jpg" class="responsive-img" alt=".NET CLI Create New Project With Target Framework Version"> <span class="card-title">.NET CLI Create New Project With Target Framework Version</span></div></a><div class="card-content article-content"><div class="summary block-with-text">使用-f參數讓我們將新增的專案放入指定的.Net Framework版本今天如果是用dotnet cli幫我們產生新的類別庫(Class Library)專案與MVC專案我們會發現預設給我們的.Net Framework不一致：而我們今天如</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2017-04-14 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/new-blackie1019.github.io/categories/NET/" class="post-category">.NET</a></span></div></div><div class="card-action article-tags"><a href="/new-blackie1019.github.io/tags/ASP-NET-Core/"><span class="chip bg-color">ASP.NET Core</span> </a><a href="/new-blackie1019.github.io/tags/NET-Core/"><span class="chip bg-color">.NET Core</span> </a><a href="/new-blackie1019.github.io/tags/NET-Core-CLI/"><span class="chip bg-color">.NET Core CLI</span></a></div></div></div></div></article></div></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.8.0/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><div class="container row center-align"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">年份</span> <a href="https://blackie1019.github.io/new-blackie1019.github.io" target="_blank">Blackie Tsai</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;Total Words:&nbsp;<span class="white-color">181.9k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;Total Pageviews:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次 </span><span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;Total Visitors:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><span id="sitetime">Loading...</span><script>function siteTime(){window.setTimeout("siteTime()",1e3);var e=1e3,t=60*e,n=60*t,o=24*n,i=365*o,r=new Date,a="2013",m="1",l="1",M="0",d="0",g="0",s=r.getFullYear(),T=r.getMonth()+1,u=r.getDate(),c=r.getHours(),f=r.getMinutes(),h=r.getSeconds(),y=Date.UTC(a,m,l,M,d,g),H=Date.UTC(s,T,u,c,f,h),I=H-y,B=Math.floor(I/i),D=Math.floor(I/o-365*B),E=Math.floor((I-(365*B+D)*o)/n),L=Math.floor((I-(365*B+D)*o-E*n)/t),w=Math.floor((I-(365*B+D)*o-E*n-L*t)/e);a==s?(document.getElementById("year").innerHTML=s,document.getElementById("sitetime").innerHTML="本站已安全運行 "+D+" 天 "+E+" 小時 "+L+" 分鐘 "+w+" 秒"):(document.getElementById("year").innerHTML=a+" - "+s,document.getElementById("sitetime").innerHTML="本站已安全運行 "+B+" 年 "+D+" 天 "+E+" 小時 "+L+" 分鐘 "+w+" 秒")}setInterval(siteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link social-statis"></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span> <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword" class="search-input"></div><div id="searchResult"></div></div></div><script src="/js/search.js"></script><script type="text/javascript">$(function(){searchFunc("/new-blackie1019.github.io/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script><script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/scrollprogress/3.0.2/scrollProgress.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-38528893-3"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-38528893-3")</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/6984b559.js","daovoice"),daovoice("init",{app_id:""}),daovoice("update")</script><script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async></script></body></html><!-- rebuild by neat -->